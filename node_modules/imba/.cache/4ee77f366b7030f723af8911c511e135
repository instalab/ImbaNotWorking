var API = require('./api').API;
var db = require("./db").db;


	API.prototype.search = async function (query){
		var q = db.table(db.raw("spaces, plainto_tsquery('english', search_preprocess(?)) query",[query])).select('id',db.raw('ts_rank_cd(search_vector, query) AS rank')).where({privacy: 'public',archived_at: null,type: 'tutorial'}).whereNot({published_at: null}).whereRaw("search_vector @@ query").orderByRaw("rank DESC");
		
		var spaces = await q;
		
		return spaces.map(function(s) { return s.id; });
	};

