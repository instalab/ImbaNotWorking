var self = {};
var env = require('../env');
var twilio = require('twilio');

var client = twilio(env.get('TWILIO_SID'),env.get('TWILIO_AUTH_TOKEN'));
// const accountSid = 'AC1da4ef9284a5cf6b0ab5ce9afeb74def';
// const authToken = 'your_auth_token';
// const client = require('twilio')(accountSid, authToken);
// client.tokens.create().then(token => console.log(token.username)).done();
var token = null;
var cretime = null;
var defaults = [{'urls': 'stun:stun.services.mozilla.com'},{'urls': 'stun:stun.l.google.com:19302'}];

exports.createToken = self.createToken = async function (){
	if (cretime && (Date.now() - cretime) < 3600000) {
		return Promise.resolve(token || defaults);
	};
	
	token = await client.tokens.create();
	if (token) { cretime = Date.now() };
	return token || {iceServers: defaults};
};
