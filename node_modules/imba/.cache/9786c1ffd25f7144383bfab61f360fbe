function iter$(a){ return a ? (a.toArray ? a.toArray() : a) : []; };
var Imba = require('imba'), _1 = Imba.createElement;
var twttrLoader;

var loadTwttr = function() {
	return twttrLoader || (twttrLoader = new Promise(function(resolve) {
		// https://dev.twitter.com/web/javascript/loading
		window.twttr = {_e: [resolve]};
		var scr = (_1('script').setSrc("https://platform.twitter.com/widgets.js")).end();
		return document.body.appendChild(scr.dom());
	}));
};


var shuffle = function(arr) {
	var i = arr.length - 1;
	while (i > 0){
		var j = Math.floor(Math.random() * (i + 1));
		var tmp = arr[i];
		arr[i] = arr[j];
		arr[j] = tmp;
		i--;
	};
	return arr;
};

var goodTweets = ["901662547409080320","865044147333283844","935101393223933952","930832142942093312","867423978297622529","883448000567103488","892811504000610317","900307093835714560"];


var TweetView = Imba.defineTag('TweetView', function(tag){
	tag.prototype.__ids = {'default': goodTweets,name: 'ids'};
	tag.prototype.ids = function(v){ return this._ids; }
	tag.prototype.setIds = function(v){ this._ids = v; return this; }
	tag.prototype._ids = goodTweets;
	tag.prototype.__count = {'default': 4,name: 'count'};
	tag.prototype.count = function(v){ return this._count; }
	tag.prototype.setCount = function(v){ this._count = v; return this; }
	tag.prototype._count = 4;
	
	tag.prototype.setup = async function (){
		tag.prototype.__super__.setup.apply(this,arguments);
		
		if (!false) {
			return;
		};
		
		if (!((this.ids() instanceof Array))) {
			return this;
		};
		
		await loadTwttr();
		
		var selection = shuffle(this.ids().slice()).slice(0,this.count());
		
		for (let i = 0, items = iter$(selection), len = items.length; i < len; i++) {
			var container = (_1('div'));
			window.twttr.widgets.createTweet(items[i],container.dom(),{cards: 'hidden',conversation: 'none',dnt: true});
			this.dom().appendChild(container.dom());
		};
		
		return this;
	};
})
exports.TweetView = TweetView;
