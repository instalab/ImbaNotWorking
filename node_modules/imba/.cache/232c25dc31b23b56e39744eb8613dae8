var Imba = require('imba'), _1 = Imba.createElement;
var uxa$ = require('uxa'), Button = uxa$.Button, Menu = uxa$.Menu;

var PlaybackMenu = Imba.defineTag('PlaybackMenu', Menu, function(tag){
	
	tag.prototype.space = function (){
		return this.data().space();
	};
	
	tag.prototype.mount = function (){
		this.dom().focus();
		return this.schedule({events: true});
	};
	
	tag.prototype.publish = function (){
		
		return this.space().view().trigger('branchpublish',this.space().branch());
	};
	
	tag.prototype.brushup = function (){
		this.space().view().trigger('annotate',this.space().branch());
		return this;
	};
	
	tag.prototype.onfocusout = function (e){
		if (!this.dom().contains(e.native().relatedTarget)) {
			return this.trigger('uxa:hide');
		};
	};
	
	
	tag.prototype.render = function (){
		var $ = this.$;
		return this.$open(0).setTabindex(-1).setChildren([
			this.space().branch().model().can(this.api().user(),'edit') ? Imba.static([
				this.space().branch().canAnnotate() ? (
					($[0] || _1('div',$,0,this).flag('item').dataset('icon','brushup').on$(0,['tap','brushup'],this).setText("Enter Post-Production")).end()
				) : void(0),
				this.space().branch().canPublish() ? (
					($[1] || _1('div',$,1,this).flag('item').flag('primary').dataset('icon','publish').on$(0,['tap','publish'],this).setText('Publish Cast')).end()
				) : void(0),
				($[2] || _1('hr',$,2,this))
			],1,1) : void(0),
			($[3] || _1('div',$,3,this).flag('field').setContent([
				_1('input',$,4,3).setType('range').setMin(0.4).setStep(0.1).setMax(2).setNumber(true),
				_1('label',$,5,3).setContent([
					_1('span',$,6,5).flag('right').flag('dim'),
					_1('span',$,7,5).setText("Playback Speed")
				],2)
			],2)).end((
				$[4].bindData(this.data(),'playbackRate',[]).end(),
				$[6].setContent(this.data().playbackRate().toFixed(1) + 'x',3)
			,true)),
			($[8] || _1('hr',$,8,this)),
			($[9] || _1('div',$,9,this).flag('item').dataset('icon','').dataset('shortcut','Space').setText("Play / Pause")).end(),
			($[10] || _1('div',$,10,this).flag('item').dataset('icon','').dataset('shortcut','⇧←').setText("Play Faster")).end(),
			($[11] || _1('div',$,11,this).flag('item').dataset('icon','').dataset('shortcut','⇧→').setText("Play Slower")).end(),
			($[12] || _1('div',$,12,this).flag('item').dataset('icon','').dataset('shortcut','→').setText("Skip Forward 10s")).end(),
			($[13] || _1('div',$,13,this).flag('item').dataset('icon','').dataset('shortcut','←').setText("Rewind 10s")).end()
		],1).synced();
	};
})
exports.PlaybackMenu = PlaybackMenu;
