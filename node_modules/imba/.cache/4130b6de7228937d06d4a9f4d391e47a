var Imba = require('imba'), _1 = Imba.createElement;
var UserAvatar = require('./UserAvatar').UserAvatar;
var Formatters$ = require('./Formatters'), TimeAgo = Formatters$.TimeAgo, Duration = Formatters$.Duration, ShortCount = Formatters$.ShortCount;
var CastPreview = require('./CastPreview').CastPreview;
var Tile = require('./Tile').Tile;
var CoverArt = require('./CoverArt').CoverArt;

var IconButton = require('uxa').IconButton;

var PlaylistTile = Imba.defineTag('PlaylistTile', Tile, function(tag){
	
	tag.reg('p');
	
	tag.Renderer = function (data,key){
		let key_, $ = this.$$ || (this.$$ = {}), $1;
		return ($[($1 = 'key$' + key)] || _1(PlaylistTile,$,$1,this)).setData(data).end();
	};
	
	tag.prototype.url = function (){
		return this.data().gid ? (("/g/" + (this.data().gid))) : this.data().url();
	};
	
	tag.prototype.render = function (){
		var $ = this.$;
		var items = this.data().items();
		var first = items[0] || {};
		
		return this.$open(0).setFlag(-1,this.data().id).setFlag(-2,this.data().type).setFlag(-3,this.data().privacy).setFlag(-4,this.data().topic_id).setChildren([
			this.data().coverart ? (
				($[0] || _1(CoverArt,$,0,this).flag('art').flag('figure')).bindData(this.data(),'coverart').end()
			) : (
				($[1] || _1(CastPreview,$,1,this).flag('figure')).setData(first).end()
			),
			
			($[2] || _1('div',$,2,this).flag('summary')).setContent([
				this.data().can(this.api().user(),'edit') ? (
					($[3] || _1('div',$,3,2).flag('actions').flag('sm').setContent(
						$[4] || _1(IconButton,$,4,3).flag('inspect').setIcon('*')
					,2)).end((
						$[4].setAction(['playlistmenu',this.data()]).end()
					,true))
				) : void(0),
				($[5] || _1('div',$,5,2).flag('title').setContent($[6] || _1('a',$,6,5),2)).end((
					$[6].setHref(this.url()).setContent(this.data().title,3).end()
				,true))
			],1)
		],1).synced();
	};
})
exports.PlaylistTile = PlaylistTile;
