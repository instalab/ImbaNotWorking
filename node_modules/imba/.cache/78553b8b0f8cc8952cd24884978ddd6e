var Imba = require('imba'), _1 = Imba.createElement;
var uxa$ = require('uxa'), Dialog = uxa$.Dialog, SelectField = uxa$.SelectField;
var Select = require('./Controls').Select;

var AddToPlaylistDialog = Imba.defineTag('AddToPlaylistDialog', Dialog, function(tag){
	
	tag.prototype.setup = function (){
		var self = this;
		tag.prototype.__super__.setup.apply(self,arguments);
		self.api().prefetch(['user',self.api().uid()]).then(function() { return self.render(); });
		return self;
	};
	
	tag.prototype.body = function (){
		let $ = this.$$ || (this.$$ = {}), t0;
		var opts = this.api().user().playlists().map(function(item) { return [item.id,item.title]; });
		return (t0 = this._body = this._body||(t0=_1('div',this)).flag('body').setContent(
			t0.$.A || _1(SelectField,t0.$,'A',t0).setName('pid').setLabel("Select playlist")
		//	for item in api.user.playlists
		//		<option value=item:id> item:title
		,2)).end((
			t0.$.A.setOptions(opts).end()
		,true));
	};
	
	tag.prototype.onuxasubmit = function (e,pars){
		var self = this;
		return self.uxa().queue().add(300,function() { return self.api().rpc('playlistAddItems',[pars.pid,[self.data().id]]); });
	};
})
exports.AddToPlaylistDialog = AddToPlaylistDialog;
